generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    USER
    TECHSUPPORT
}

enum Award {
    HALF_YEAR_ON_SITE
    ONE_YEAR_ON_SITE
    TWO_YEARS_ON_SITE
    THREE_YEARS_ON_SITE
    FOUR_YEARS_ON_SITE
    FIVE_YEARS_ON_SITE
    MESSANGER //Отправить 10к сообщений
    RECIEVER //Получить 10к сообщений
    PUBLIC1 //10 чатов
    PUBLIC2 //25 чатов
    PUBLIC3 //50 чатов
    PUBLIC4 //100 Чатов
    PUBLIC5 //250 Чатов
}

model User {
  id Int @id @default(autoincrement())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  username String    @unique
  nickname String?   @default("nickname")
  password String
  email    String
  photo    String    @default("user")
  telegram String    @unique
  salt     String
  Chats    Chat[]
  awards   Award[]
  role     Role      @default(USER)
  User1    Dialog[]  @relation("user1_chat")
  User2    Dialog[]  @relation("user2_chat")
  Message  Message[]
}

model Visit {
  id Int @id @default(autoincrement())
  visitAt DateTime @default(now())
  method  String   @default("request")

  ip String
}

model VerifyToken {
  id Int @id @default(autoincrement())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  value    String @unique
  password String
  salt     String
  username String @unique
  email    String @unique
}

model Message {
  id Int @id @default(autoincrement())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender User @relation(fields: [senderId], references: [id])

  message String

  senderId Int
  Dialog   Dialog? @relation(fields: [dialogId], references: [id])
  dialogId Int?
}

model Dialog {
  id Int @id @default(autoincrement())
  DialogName String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user1Id Int
  user2Id Int

  user1Name String
  user2Name String

  user1 User @relation("user1_chat", fields: [user1Id], references: [id])
  user2 User @relation("user2_chat", fields: [user2Id], references: [id])

  messages Message[]
  secret   String
}

model Chat {
  id Int @id @default(autoincrement())
  ChatName String @default(uuid())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users User[]

  secret   String
}
