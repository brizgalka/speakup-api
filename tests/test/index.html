<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel ="stylesheet" href = "./app.css">
        <link rel ="stylesheet" href = "./fonts.css">
        <link rel ="stylesheet" href = "./main.css">
        <script src = "./wsConnection.js"></script>
        <title>Document</title>
    </head>
    <body>
        <div class = "app">
            <div class = "reg">
                <h1>Registration</h1>
                <h3>Username</h3>
                <input placeholder="username" id = "username">
                <br>
                <h3>Email</h3>
                <input placeholder="email" id = "email">
                <br>
                <h3>Password</h3>
                <input placeholder="password" type="password" id = "password">
                <br>
                <button id = "send">Submit</button>
            </div>
        </div>
        <div class = "waiting">
            <img src = "./loading.gif">
            <h3>Your verify command is /verify <span id = "verify-code"></span></h3>
            <p>Input them in telegram bot: @speakupconf_bot</p>
        </div>
        <script>
            const button = document.querySelector("#send")
            const reg = document.querySelector(".reg")
            const waiting = document.querySelector(".waiting")
            const verify_code = document.querySelector("#verify-code")
            waiting.style.display = "none"
            button.addEventListener("click",e => {
                let xhr = new XMLHttpRequest();
                const username = document.querySelector("#username").value
                const email = document.querySelector("#email").value
                const password = document.querySelector("#password").value

                let json = JSON.stringify({
                    "password": password,
                    "email": email,
                    "username": username
                });

                xhr.open('POST', 'http://localhost:6060/user/registration')

                xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');

                xhr.send(json);

                xhr.onload = function() {
                    console.log(xhr)
                    if(xhr.status == 200) {
                        const response = JSON.parse(xhr.response)
                        reg.remove()
                        waiting.style.display = "block"
                        verify_code.innerHTML = response["verifyToken"]
                    }
                };
                xhr.onerror = function() {
                    alert("Запрос не удался");
                };
            })
        </script>
    </body>
</html>